<div class="container">
  <div class="row">
    <div class="col s12">
      <h3 class="center-align indigo-text text-darken-4">Gestión de Cargas y Mercancía</h3>
      <a class="waves-effect waves-light btn modal-trigger indigo darken-2" (click)="abrirModalCrear()">
        <i class="material-icons left">add</i>Nueva Carga
      </a>

      <table class="striped responsive-table z-depth-1 hoverable mt-3">
        <thead>
          <tr class="indigo lighten-5">
            <th>ID</th>
            <th>Descripción</th>
            <th>Peso (kg)</th>
            <th>Origen / Destino</th>
            <th>Propietario</th>
            <th>Conductor Asignado</th> 
            <th>Fecha Recogida</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let carga of cargas">
            <td>{{ carga._id | slice:0:4 }}...</td>
            <td>{{ carga.descripcion }}</td>
            <td>{{ carga.peso | number:'1.0-2' }}</td>
            <td>{{ carga.origen }} <i class="material-icons tiny">arrow_forward</i> {{ carga.destino }}</td>
            <td>{{ carga.propietario_nombre }}</td>
            <td>{{ carga.conductor_id ? ('Asignado (' + (carga.conductor_id | slice:0:4) + '...') : 'N/A' }}</td> 
            <td>{{ carga.fecha_recogida | date:'mediumDate' }}</td>
            <td>
              <span class="new badge" [attr.data-badge-caption]="carga.estado" 
                  [class.orange]="carga.estado === 'Pendiente'" 
                  [class.green]="carga.estado === 'Entregada'"
                  [class.blue]="carga.estado === 'Asignada'"
                  [class.purple]="carga.estado === 'En Ruta'"
                  [class.red]="carga.estado === 'Cancelada'">
              </span>
            </td>
            <td>
              <button class="btn-small waves-effect waves-light blue" (click)="abrirModalEditar(carga)">
                <i class="material-icons">edit</i>
              </button>
              <button class="btn-small waves-effect waves-light red darken-1 ml-2" (click)="eliminarCarga(carga._id)">
                <i class="material-icons">delete</i>
              </button>
            </td>
          </tr>
          <tr *ngIf="cargas.length === 0">
            <td colspan="9" class="center-align grey-text">No hay cargas registradas.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div id="modalCarga" class="modal">
  <div class="modal-content">
    <h4 class="center-align indigo-text text-darken-4">{{ isEditing ? 'Editar Carga' : 'Crear Nueva Carga' }}</h4>
    
    <form (ngSubmit)="guardarCarga()">
      <div class="row">
        <div class="input-field col s12 m6">
          <select id="propietario_id" [(ngModel)]="cargaSeleccionada.propietario_id" name="propietario_id" class="browser-default" required>
            <option value="" disabled selected>Seleccione el Cliente Propietario</option>
            <option *ngFor="let cliente of clientes" [value]="cliente._id">{{ cliente.nombre }} ({{ cliente.email }})</option>
          </select>
          <label for="propietario_id" class="active">Propietario (Cliente)</label>
        </div>
        
        <div class="input-field col s12 m6">
          <input id="peso" type="number" [(ngModel)]="cargaSeleccionada.peso" name="peso" required min="1">
          <label for="peso" [class.active]="cargaSeleccionada.peso">Peso (kg)</label>
        </div>
      </div>

      <div class="row">
          <div class="input-field col s12">
              <textarea id="descripcion" class="materialize-textarea" [(ngModel)]="cargaSeleccionada.descripcion" name="descripcion" required></textarea>
              <label for="descripcion" [class.active]="cargaSeleccionada.descripcion">Descripción de la Carga</label>
          </div>
      </div>

      <div class="row">
        <div class="input-field col s12 m4">
          <input id="origen" type="text" [(ngModel)]="cargaSeleccionada.origen" name="origen" required>
          <label for="origen" [class.active]="cargaSeleccionada.origen">Origen</label>
        </div>
        <div class="input-field col s12 m4">
          <input id="destino" type="text" [(ngModel)]="cargaSeleccionada.destino" name="destino" required>
          <label for="destino" [class.active]="cargaSeleccionada.destino">Destino</label>
        </div>
        <div class="input-field col s12 m4">
          <input id="fecha_recogida" type="date" [(ngModel)]="cargaSeleccionada.fecha_recogida" name="fecha_recogida" required>
          <label for="fecha_recogida" [class.active]="cargaSeleccionada.fecha_recogida">Fecha de Recogida</label>
        </div>
      </div>
      
      <div class="row">
          <div class="input-field col s12 m6">
              <select id="conductor_id" [(ngModel)]="cargaSeleccionada.conductor_id" name="conductor_id" class="browser-default">
                  <option [ngValue]="undefined" selected>Sin Asignar</option>
                  <option *ngFor="let conductor of conductores" [value]="conductor._id">{{ conductor.nombre }} ({{ conductor.email }})</option>
              </select>
              <label for="conductor_id" class="active">Conductor Asignado</label>
          </div>
          
          <div class="input-field col s12 m6">
              <select id="estado" [(ngModel)]="cargaSeleccionada.estado" name="estado" class="browser-default" required>
                  <option value="" disabled>Seleccione el Estado</option>
                  <option *ngFor="let estado of estados" [value]="estado">{{ estado }}</option>
              </select>
              <label for="estado" class="active">Estado de la Carga</label>
          </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="modal-close waves-effect waves-red btn-flat">Cancelar</button>
        <button type="submit" class="waves-effect waves-green btn-flat indigo-text text-darken-4">
          {{ isEditing ? 'Guardar Cambios' : 'Crear Carga' }}
        </button>
      </div>
    </form>
  </div>
</div>
<style>
  /* Estilos solo para este componente */
  .mt-3 {
    margin-top: 20px;
  }
  .ml-2 {
    margin-left: 8px;
  }
</style>